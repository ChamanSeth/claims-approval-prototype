<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Accuray Claims Approval Tool – Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary: #00c1e0; /* Accuray teal */
      --primary-dark: #0096af;
      --bg: #f5f7fa;
      --card-bg: #ffffff;
      --border: #dde3ec;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --danger: #dc2626;
      --success: #16a34a;
      --warning: #f59e0b;
      --radius-lg: 12px;
      --radius-sm: 6px;
      --shadow-soft: 0 4px 12px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      color: #fff;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    header .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    header .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 18px;
      font-weight: 700;
    }

    header .brand-subtitle {
      font-size: 12px;
      opacity: 0.9;
      margin-top: 2px;
    }

    header .user-panel {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .pill-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      font-size: 14px;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease;
      background: #fff;
    }

    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(0, 193, 224, 0.3);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .user-panel input[type="text"],
    .user-panel select {
      width: auto;
      min-width: 140px;
      background: rgba(255, 255, 255, 0.9);
    }

    main {
      flex: 1;
      padding: 16px;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto 24px;
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .tab-btn {
      border: none;
      padding: 8px 14px;
      border-radius: 999px;
      background: transparent;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, color 0.15s ease;
    }

    .tab-btn.active {
      background: #e0f9fe;
      color: var(--primary-dark);
      font-weight: 600;
    }

    .tab-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.8);
      color: var(--primary-dark);
    }

    .layout-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.3fr);
      gap: 16px;
    }

    @media (max-width: 900px) {
      .layout-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 16px 18px;
      border: 1px solid rgba(148, 163, 184, 0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5f3ff;
      color: #1d4ed8;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 6px;
    }

    .field {
      margin-bottom: 10px;
    }

    .field label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .field-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-muted);
    }

    .btn-row {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s ease, transform 0.05s ease,
        box-shadow 0.15s ease;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 2px 6px rgba(0, 193, 224, 0.35);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0, 193, 224, 0.4);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
    }

    .chip-outline {
      background: transparent;
      border: 1px dashed #cbd5f5;
      color: #4b5563;
    }

    /* Dashboard metrics */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 900px) {
      .metrics-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 560px) {
      .metrics-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .metric-card {
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      background: #f9fafb;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .metric-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 6px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .metric-pill {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
    }

    .metric-pill.success {
      background: rgba(22, 163, 74, 0.08);
      color: var(--success);
    }

    .metric-pill.warning {
      background: rgba(245, 158, 11, 0.08);
      color: var(--warning);
    }

    /* Simple bar chart */
    .chart {
      margin-top: 10px;
    }

    .chart-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .chart-label {
      width: 80px;
      text-align: right;
    }

    .chart-bar-track {
      flex: 1;
      height: 7px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .chart-bar {
      height: 100%;
      border-radius: 999px;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .chart-value {
      width: 24px;
      text-align: left;
      font-size: 11px;
    }

    /* Approver pipeline table */
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 13px;
    }

    .table th,
    .table td {
      padding: 6px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    .table th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      background: #f9fafb;
    }

    .status-pill {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.08);
      color: var(--warning);
    }

    .status-inreview {
      background: rgba(37, 99, 235, 0.08);
      color: #2563eb;
    }

    .status-approved {
      background: rgba(22, 163, 74, 0.08);
      color: var(--success);
    }

    .status-rejected {
      background: rgba(220, 38, 38, 0.08);
      color: var(--danger);
    }

    .status-stage-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    .action-btn {
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 3px 8px;
      background: #fff;
      cursor: pointer;
    }

    .action-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    /* Repository filters */
    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .filters-row input[type="text"],
    .filters-row select {
      min-width: 130px;
      font-size: 12px;
    }

    .tag {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #ecfeff;
      color: #0e7490;
      border: 1px solid #bae6fd;
    }

    .tag.soft {
      background: #eef2ff;
      color: #4338ca;
      border-color: #c7d2fe;
    }

    .empty-state {
      font-size: 13px;
      color: var(--text-muted);
      padding: 12px;
      border-radius: var(--radius-lg);
      background: #f9fafb;
      border: 1px dashed #d1d5db;
      text-align: center;
    }

    .note {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="brand">
        <div class="brand-logo">A</div>
        <div>
          <div>Accuray Claims Approval Tool</div>
          <div class="brand-subtitle">
            Prototype – Internal use only
          </div>
        </div>
      </div>
      <div class="user-panel">
        <div>
          <div class="pill-label">Logged in as</div>
          <input
            type="text"
            id="userNameInput"
            placeholder="Your name"
            value="Demo User"
          />
        </div>
        <div>
          <div class="pill-label">Role</div>
          <select id="roleSelect">
            <option value="submitter">Submitter</option>
            <option value="product">Product Approver</option>
            <option value="system">System Dept Approver</option>
            <option value="marketing">Marketing</option>
            <option value="ra">Regulatory Affairs</option>
            <option value="legal">Legal</option>
          </select>
        </div>
      </div>
    </header>

    <main>
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" data-tab="submit">
          Submit Claim
        </button>
        <button class="tab-btn" data-tab="dashboard">
          Approver Dashboard
          <span class="tab-badge" id="pendingCountBadge">3</span>
        </button>
        <button class="tab-btn" data-tab="repository">
          Claims Repository
        </button>
      </div>

      <!-- SUBMIT CLAIM VIEW -->
      <section id="tab-submit">
        <div class="layout-grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">New Claim Request</div>
                <div class="card-subtitle">
                  Any Accuray employee can submit a claim for review.
                </div>
              </div>
              <span class="badge">Step 1 – Submission</span>
            </div>

            <div class="field">
              <label>Requester name</label>
              <input
                type="text"
                id="fieldRequester"
                placeholder="Your full name"
              />
            </div>

            <div class="field">
              <label>Broad claim theme</label>
              <select id="fieldTheme">
                <option value="">Select theme</option>
                <option value="Product">Product-related claim</option>
                <option value="Software">Software-related claim</option>
                <option value="Service">Service-related claim</option>
              </select>
            </div>

            <div class="field">
              <label>Specific offering</label>
              <select id="fieldOffering">
                <option value="">Select offering</option>
                <option value="CyberKnife S7">CyberKnife® S7™</option>
                <option value="Radixact">Radixact®</option>
                <option value="Accuray Helix">Accuray Helix™</option>
                <option value="Accuray Stellar">Accuray Stellar™</option>
                <option value="Other">Other / Not listed</option>
              </select>
              <div class="field-hint">
                Example: CyberKnife® S7™, Radixact®, Helix™, Stellar™, etc.
              </div>
            </div>

            <div class="field">
              <label>Claim text</label>
              <textarea
                id="fieldClaimText"
                placeholder="Write the exact claim sentence or paragraph you want to use."
              ></textarea>
            </div>

            <div class="field">
              <label>Supporting evidence (description)</label>
              <textarea
                id="fieldEvidence"
                placeholder="Describe or reference clinical data, technical records, or internal documents. (File upload placeholder)"
              ></textarea>
              <div class="field-hint">
                In a full build, this would include actual file upload.
              </div>
            </div>

            <div class="field">
              <label>Intended audience</label>
              <select id="fieldAudience">
                <option value="">Select audience</option>
                <option value="Clinicians / Radiation Oncologists">
                  Clinicians / Radiation Oncologists
                </option>
                <option value="Hospital Administrators">
                  Hospital Administrators
                </option>
                <option value="Patients / Public">Patients / Public</option>
                <option value="Internal staff">Internal staff</option>
              </select>
            </div>

            <div class="field">
              <label>Intended collateral type</label>
              <select id="fieldCollateral">
                <option value="">Select collateral type</option>
                <option value="Customer presentation">
                  Customer presentation
                </option>
                <option value="Brochure / PDF">Brochure / PDF</option>
                <option value="Social media">Social media</option>
                <option value="Website copy">Website copy</option>
                <option value="Internal communication">
                  Internal communication
                </option>
              </select>
            </div>

            <div class="field">
              <label>Additional notes (optional)</label>
              <textarea
                id="fieldNotes"
                placeholder="Anything else approvers should know?"
              ></textarea>
            </div>

            <div class="btn-row">
              <button class="btn btn-primary" id="btnSubmitClaim">
                Submit claim for approval
              </button>
              <button class="btn btn-ghost" id="btnClearForm">
                Clear form
              </button>
            </div>

            <div class="note" id="submitNote">
              This prototype stores claims in memory only (no real backend).
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Workflow Snapshot</div>
                <div class="card-subtitle">
                  Your claim will follow this staged approval path.
                </div>
              </div>
            </div>

            <div class="section-title">Approval stages</div>
            <ol style="font-size:13px; color:var(--text-muted); padding-left:18px;">
              <li>Product Team – initial validation.</li>
              <li>
                System Department – Engineering / Clinical / Software / Service.
              </li>
              <li>Marketing – rephrasing & messaging alignment.</li>
              <li>Regulatory Affairs – regulatory compliance.</li>
              <li>Legal – final legal approval.</li>
            </ol>

            <div class="section-title">Context tag concept</div>
            <p style="font-size:13px; color:var(--text-muted); margin-top:4px;">
              Approvers will attach a <strong>context tag</strong> specifying
              where the claim can be used (e.g., “Customer presentations only”,
              “Social media allowed”, “Internal use only”).
            </p>

            <div class="chip-row">
              <span class="chip">Customer presentations</span>
              <span class="chip">Social media</span>
              <span class="chip">Rad oncologists only</span>
              <span class="chip chip-outline">Internal only</span>
            </div>
          </div>
        </div>
      </section>

      <!-- APPROVER DASHBOARD VIEW -->
      <section id="tab-dashboard" style="display:none;">
        <div class="card" style="margin-bottom:14px;">
          <div class="card-header">
            <div>
              <div class="card-title">Approver Dashboard</div>
              <div class="card-subtitle">
                High-level overview of your pending workload and flow by stage.
              </div>
            </div>
            <span class="badge" id="roleBadge">Role: Product Approver</span>
          </div>

          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-label">Pending in your queue</div>
              <div class="metric-value">
                <span id="metricPending">3</span>
                <span class="metric-pill warning">action needed</span>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Approved this month</div>
              <div class="metric-value">
                <span id="metricApproved">5</span>
                <span class="metric-pill success">processed</span>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Rejected / returned</div>
              <div class="metric-value">
                <span id="metricRejected">1</span>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Avg. days in stage</div>
              <div class="metric-value">
                <span id="metricAvgDays">2.4</span>
              </div>
            </div>
          </div>

          <div class="chart">
            <div class="section-title">Pipeline by stage</div>

            <div class="chart-row">
              <div class="chart-label">Product</div>
              <div class="chart-bar-track">
                <div
                  class="chart-bar"
                  id="barProduct"
                  style="width: 60%;"
                ></div>
              </div>
              <div class="chart-value" id="valProduct">3</div>
            </div>

            <div class="chart-row">
              <div class="chart-label">System</div>
              <div class="chart-bar-track">
                <div
                  class="chart-bar"
                  id="barSystem"
                  style="width: 40%;"
                ></div>
              </div>
              <div class="chart-value" id="valSystem">2</div>
            </div>

            <div class="chart-row">
              <div class="chart-label">Marketing</div>
              <div class="chart-bar-track">
                <div
                  class="chart-bar"
                  id="barMarketing"
                  style="width: 30%;"
                ></div>
              </div>
              <div class="chart-value" id="valMarketing">1</div>
            </div>

            <div class="chart-row">
              <div class="chart-label">RA / Legal</div>
              <div class="chart-bar-track">
                <div
                  class="chart-bar"
                  id="barRALegal"
                  style="width: 20%;"
                ></div>
              </div>
              <div class="chart-value" id="valRALegal">1</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Your approval pipeline</div>
              <div class="card-subtitle">
                Claims currently waiting at your stage.
              </div>
            </div>
          </div>

          <table class="table" id="approverTable">
            <thead>
              <tr>
                <th>Claim ID</th>
                <th>Offering</th>
                <th>Stage</th>
                <th>Requester</th>
                <th>Context tag</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows are populated by JS -->
            </tbody>
          </table>

          <div class="note">
            This is a static prototype. Buttons don’t yet persist changes to a
            backend – they only simulate status changes in the browser.
          </div>
        </div>
      </section>

      <!-- CLAIMS REPOSITORY VIEW -->
      <section id="tab-repository" style="display:none;">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Claims Repository</div>
              <div class="card-subtitle">
                View approved and in-review claims with filters and context
                tags.
              </div>
            </div>
          </div>

          <div class="filters-row">
            <input
              type="text"
              id="filterSearch"
              placeholder="Search by keyword..."
            />
            <select id="filterOffering">
              <option value="">Offering (all)</option>
            </select>
            <select id="filterStatus">
              <option value="">Status (all)</option>
              <option value="Approved">Approved</option>
              <option value="Pending">Pending</option>
              <option value="In Review">In Review</option>
              <option value="Rejected">Rejected</option>
            </select>
            <select id="filterTheme">
              <option value="">Theme (all)</option>
              <option value="Product">Product</option>
              <option value="Software">Software</option>
              <option value="Service">Service</option>
            </select>
          </div>

          <table class="table" id="repoTable">
            <thead>
              <tr>
                <th>Claim ID</th>
                <th>Claim</th>
                <th>Offering</th>
                <th>Theme</th>
                <th>Status</th>
                <th>Context tag</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filled via JS -->
            </tbody>
          </table>

          <div class="empty-state" id="repoEmpty" style="display:none;">
            No claims match the current filters. Try clearing them or submitting
            a new claim.
          </div>

          <div class="note">
            Future enhancements: export to CSV / PDF, advanced filters,
            integration with master control document system.
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // -----------------------------
    // Simple in-browser data model
    // -----------------------------
    let claims = [
      {
        id: "CLM-001",
        requester: "Alex Chen",
        theme: "Product",
        offering: "CyberKnife S7",
        claimText:
          "CyberKnife S7 enables highly precise stereotactic treatments in fewer sessions.",
        status: "Pending",
        stage: "Product",
        contextTag: "Customer presentations only",
      },
      {
        id: "CLM-002",
        requester: "Maria Lopez",
        theme: "Software",
        offering: "Radixact",
        claimText:
          "Radixact planning software streamlines workflows across the RT department.",
        status: "In Review",
        stage: "System",
        contextTag: "Internal staff & admin",
      },
      {
        id: "CLM-003",
        requester: "Demo User",
        theme: "Service",
        offering: "Accuray Stellar",
        claimText:
          "Accuray Stellar service program helps maintain uptime and treatment confidence.",
        status: "Approved",
        stage: "Legal",
        contextTag: "Website & brochures",
      },
    ];

    // Populate offering filter options dynamically
    function refreshOfferingFilter() {
      const offerings = Array.from(new Set(claims.map((c) => c.offering)));
      const filterOffering = document.getElementById("filterOffering");
      filterOffering.innerHTML = '<option value="">Offering (all)</option>';
      offerings.forEach((o) => {
        const opt = document.createElement("option");
        opt.value = o;
        opt.textContent = o;
        filterOffering.appendChild(opt);
      });
    }

    // -----------------------------
    // Tabs handling
    // -----------------------------
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabSections = {
      submit: document.getElementById("tab-submit"),
      dashboard: document.getElementById("tab-dashboard"),
      repository: document.getElementById("tab-repository"),
    };

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;

        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        Object.entries(tabSections).forEach(([key, section]) => {
          section.style.display = key === tab ? "block" : "none";
        });

        if (tab === "dashboard") {
          renderApproverView();
        } else if (tab === "repository") {
          renderRepository();
        }
      });
    });

    // -----------------------------
    // Role handling (for dashboard)
    // -----------------------------
    const roleSelect = document.getElementById("roleSelect");
    const roleBadge = document.getElementById("roleBadge");

    function getRoleLabel(role) {
      switch (role) {
        case "submitter":
          return "Submitter";
        case "product":
          return "Product Approver";
        case "system":
          return "System Dept Approver";
        case "marketing":
          return "Marketing";
        case "ra":
          return "Regulatory Affairs";
        case "legal":
          return "Legal";
        default:
          return role;
      }
    }

    roleSelect.addEventListener("change", () => {
      roleBadge.textContent = "Role: " + getRoleLabel(roleSelect.value);
      renderApproverView();
    });

    // -----------------------------
    // Submit form behaviour
    // -----------------------------
    const requesterInput = document.getElementById("fieldRequester");
    const userNameInput = document.getElementById("userNameInput");

    // Sync header user into requester field when focusing
    requesterInput.addEventListener("focus", () => {
      if (!requesterInput.value && userNameInput.value) {
        requesterInput.value = userNameInput.value;
      }
    });

    document.getElementById("btnClearForm").addEventListener("click", () => {
      [
        "fieldRequester",
        "fieldTheme",
        "fieldOffering",
        "fieldClaimText",
        "fieldEvidence",
        "fieldAudience",
        "fieldCollateral",
        "fieldNotes",
      ].forEach((id) => {
        const el = document.getElementById(id);
        if (el.tagName === "SELECT") el.value = "";
        else el.value = "";
      });
    });

    document.getElementById("btnSubmitClaim").addEventListener("click", () => {
      const requester = requesterInput.value.trim() || "Unknown requester";
      const theme =
        document.getElementById("fieldTheme").value || "Product";
      const offering =
        document.getElementById("fieldOffering").value || "Other";
      const claimText =
        document.getElementById("fieldClaimText").value.trim() ||
        "No claim text provided.";
      const newId = "CLM-" + String(claims.length + 1).padStart(3, "0");

      const newClaim = {
        id: newId,
        requester,
        theme,
        offering,
        claimText,
        status: "Pending",
        stage: "Product", // first stage
        contextTag: "TBD – context to be set by approvers",
      };

      claims.unshift(newClaim); // add to top
      refreshOfferingFilter();
      renderApproverView();
      renderRepository();

      const submitNote = document.getElementById("submitNote");
      submitNote.textContent =
        "Claim " +
        newId +
        " submitted and added to the Product queue in this prototype.";
    });

    // -----------------------------
    // Approver dashboard + pipeline
    // -----------------------------
    function renderApproverView() {
      const role = roleSelect.value;
      const stageMap = {
        product: "Product",
        system: "System",
        marketing: "Marketing",
        ra: "RA",
        legal: "Legal",
      };

      const myStage = stageMap[role];

      // Filter claims for "my" stage
      const myClaims =
        myStage !== undefined
          ? claims.filter((c) => c.stage === myStage && c.status !== "Approved")
          : [];

      // Basic metrics
      document.getElementById("metricPending").textContent = myClaims.length;

      const approvedCount = claims.filter(
        (c) => c.status === "Approved"
      ).length;
      const rejectedCount = claims.filter(
        (c) => c.status === "Rejected"
      ).length;

      document.getElementById("metricApproved").textContent = approvedCount;
      document.getElementById("metricRejected").textContent = rejectedCount;

      // Dummy average days
      document.getElementById("metricAvgDays").textContent = (
        1.8 +
        Math.min(myClaims.length, 4) * 0.3
      ).toFixed(1);

      // Simple bar widths based on counts
      const productCount = claims.filter((c) => c.stage === "Product").length;
      const systemCount = claims.filter((c) => c.stage === "System").length;
      const marketingCount = claims.filter(
        (c) => c.stage === "Marketing"
      ).length;
      const raLegalCount = claims.filter(
        (c) => c.stage === "RA" || c.stage === "Legal"
      ).length;

      function widthFor(n) {
        const max = Math.max(
          1,
          productCount,
          systemCount,
          marketingCount,
          raLegalCount
        );
        return ((n / max) * 100).toFixed(0) + "%";
      }

      document.getElementById("barProduct").style.width =
        widthFor(productCount);
      document.getElementById("barSystem").style.width =
        widthFor(systemCount);
      document.getElementById("barMarketing").style.width =
        widthFor(marketingCount);
      document.getElementById("barRALegal").style.width =
        widthFor(raLegalCount);

      document.getElementById("valProduct").textContent = productCount;
      document.getElementById("valSystem").textContent = systemCount;
      document.getElementById("valMarketing").textContent = marketingCount;
      document.getElementById("valRALegal").textContent = raLegalCount;

      // Update tab badge for pending count
      document.getElementById("pendingCountBadge").textContent =
        myClaims.length;

      // Populate pipeline table
      const tbody = document.querySelector("#approverTable tbody");
      tbody.innerHTML = "";

      if (!myStage) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 6;
        td.textContent =
          "Switch to an approver role (Product, System, Marketing, RA, Legal) to see a pipeline.";
        td.style.color = "#6b7280";
        td.style.fontSize = "13px";
        tbody.appendChild(tr);
        tr.appendChild(td);
        return;
      }

      if (myClaims.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 6;
        td.textContent = "No claims currently pending at your stage.";
        td.style.color = "#6b7280";
        td.style.fontSize = "13px";
        tbody.appendChild(tr);
        tr.appendChild(td);
        return;
      }

      myClaims.forEach((c) => {
        const tr = document.createElement("tr");

        const tdId = document.createElement("td");
        tdId.textContent = c.id;

        const tdOff = document.createElement("td");
        tdOff.textContent = c.offering;

        const tdStage = document.createElement("td");
        const stageSpan = document.createElement("span");
        stageSpan.className = "status-pill status-inreview";
        const dot = document.createElement("span");
        dot.className = "status-stage-dot";
        stageSpan.appendChild(dot);
        const txt = document.createTextNode(" " + c.stage);
        stageSpan.appendChild(txt);
        tdStage.appendChild(stageSpan);

        const tdReq = document.createElement("td");
        tdReq.textContent = c.requester;

        const tdContext = document.createElement("td");
        const tag = document.createElement("span");
        tag.className = "tag soft";
        tag.textContent = c.contextTag;
        tdContext.appendChild(tag);

        const tdActions = document.createElement("td");
        const actionRow = document.createElement("div");
        actionRow.className = "action-row";

        const approveBtn = document.createElement("button");
        approveBtn.className = "action-btn";
        approveBtn.textContent = "Approve";
        approveBtn.addEventListener("click", () =>
          advanceClaim(c.id, "approve", myStage)
        );

        const rejectBtn = document.createElement("button");
        rejectBtn.className = "action-btn";
        rejectBtn.textContent = "Reject";
        rejectBtn.addEventListener("click", () =>
          advanceClaim(c.id, "reject", myStage)
        );

        const editBtn = document.createElement("button");
        editBtn.className = "action-btn";
        editBtn.textContent = "Request info";
        editBtn.addEventListener("click", () =>
          advanceClaim(c.id, "request", myStage)
        );

        actionRow.appendChild(approveBtn);
        actionRow.appendChild(rejectBtn);
        actionRow.appendChild(editBtn);
        tdActions.appendChild(actionRow);

        tr.appendChild(tdId);
        tr.appendChild(tdOff);
        tr.appendChild(tdStage);
        tr.appendChild(tdReq);
        tr.appendChild(tdContext);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
      });
    }

    function advanceClaim(id, action, stage) {
      const idx = claims.findIndex((c) => c.id === id);
      if (idx === -1) return;
      const claim = claims[idx];

      if (action === "reject") {
        claim.status = "Rejected";
      } else if (action === "request") {
        claim.status = "In Review";
      } else if (action === "approve") {
        // Move to next stage or final approve
        if (stage === "Product") claim.stage = "System";
        else if (stage === "System") claim.stage = "Marketing";
        else if (stage === "Marketing") claim.stage = "RA";
        else if (stage === "RA") claim.stage = "Legal";
        else if (stage === "Legal") {
          claim.status = "Approved";
        }
      }

      renderApproverView();
      renderRepository();
    }

    // -----------------------------
    // Repository rendering + filters
    // -----------------------------
    function renderRepository() {
      const search = document
        .getElementById("filterSearch")
        .value.toLowerCase();
      const status = document.getElementById("filterStatus").value;
      const theme = document.getElementById("filterTheme").value;
      const offering = document.getElementById("filterOffering").value;

      const tbody = document.querySelector("#repoTable tbody");
      const empty = document.getElementById("repoEmpty");

      let filtered = claims.filter((c) => {
        if (status && c.status !== status) return false;
        if (theme && c.theme !== theme) return false;
        if (offering && c.offering !== offering) return false;

        if (search) {
          const text =
            (c.id + " " + c.claimText + " " + c.contextTag).toLowerCase();
          if (!text.includes(search)) return false;
        }
        return true;
      });

      tbody.innerHTML = "";

      if (filtered.length === 0) {
        empty.style.display = "block";
        return;
      } else {
        empty.style.display = "none";
      }

      filtered.forEach((c) => {
        const tr = document.createElement("tr");

        const tdId = document.createElement("td");
        tdId.textContent = c.id;

        const tdClaim = document.createElement("td");
        tdClaim.textContent = c.claimText;

        const tdOff = document.createElement("td");
        tdOff.textContent = c.offering;

        const tdTheme = document.createElement("td");
        tdTheme.textContent = c.theme;

        const tdStatus = document.createElement("td");
        const statusPill = document.createElement("span");
        statusPill.className = "status-pill";
        if (c.status === "Approved")
          statusPill.classList.add("status-approved");
        else if (c.status === "Rejected")
          statusPill.classList.add("status-rejected");
        else if (c.status === "Pending")
          statusPill.classList.add("status-pending");
        else statusPill.classList.add("status-inreview");

        statusPill.textContent = c.status;
        tdStatus.appendChild(statusPill);

        const tdContext = document.createElement("td");
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = c.contextTag;
        tdContext.appendChild(tag);

        tr.appendChild(tdId);
        tr.appendChild(tdClaim);
        tr.appendChild(tdOff);
        tr.appendChild(tdTheme);
        tr.appendChild(tdStatus);
        tr.appendChild(tdContext);

        tbody.appendChild(tr);
      });
    }

    // Filters listeners
    ["filterSearch", "filterStatus", "filterTheme", "filterOffering"].forEach(
      (id) => {
        const el = document.getElementById(id);
        el.addEventListener("input", renderRepository);
        el.addEventListener("change", renderRepository);
      }
    );

    // Initial render
    refreshOfferingFilter();
    renderApproverView();
    renderRepository();
  </script>
</body>
</html>